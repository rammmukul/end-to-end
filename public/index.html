<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <script src="./libsignal-protocol.js"></script>
  <script src="./store.js"></script>
  <script src="./helper.js"></script>
  <script>
    let keyHelper = libsignal.KeyHelper
    let registrationId = keyHelper.generateRegistrationId()
    let store = new SignalProtocolStore()

    localStorage.setItem('registrationId', registrationId)
    let pub, pri, keyPair
    keyHelper.generateIdentityKeyPair().then(identityKeyPair => {
      console.log(identityKeyPair)
      store.put('identityKey', keyPairToString(identityKeyPair))

      let keyId = Math.floor(Math.random() * 999) //replace with uid

      keyHelper.generatePreKey(keyId).then(function (preKey) {
        console.log(preKey)
        store.storePreKey(preKey.keyId, keyPairToString(preKey.keyPair));
      })

      keyHelper.generateSignedPreKey(identityKeyPair, keyId).then(function (signedPreKey) {
        console.log(signedPreKey)
        store.storeSignedPreKey(signedPreKey.keyId, keyPairToString(signedPreKey.keyPair));
      })
    })
  </script>
  <title>message</title>
</head>

<body>
  <form action="" method="POST" onsubmit="">
    <input name="message" type="text">
    <input type="submit">
  </form>
</body>

</html>